var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},myInfo;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i.count=60,i._phone=t,i.skinName="BindPhoneVCSkin",i}return __extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEvent(),this.init(),this.setData(this._phone)},i.prototype.setData=function(t){var e=t?!1:!0;this._phoneNum.visible=e,this._phoneTxt.visible=!e,this._confirm.visible=e,this._relieve.visible=!e,this._phone_bg.visible=e,this._sendCaptcha.enabled=!e,this._phoneTxt.text=t?t+"":""},i.prototype.destory=function(){this.removeEvent(),this.timer&&(this.timer.stop(),this.timer=null)},i.prototype.init=function(){this._phoneNum.text="",this._phoneNum.restrict="0-9",this._captcha.text="",this._captcha.restrict="0-9",this.timer=null,this.count=60,this._sendCaptcha.enabled=!1,this.phone=null,this.password=null},i.prototype.addEvent=function(){uniLib.Global.addEventListener(t.MyInfoConst.GET_INFO,this.onBind,this),uniLib.Global.addEventListener(t.MyInfoConst.PHONE_BIND,this.backHander,this),this._back.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backHander,this),this._confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmHandle,this),this._relieve.addEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmHandle,this),this._sendCaptcha.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getCaptcha,this),this._phoneNum.addEventListener(egret.Event.CHANGE,this.verifyPhone,this),this._captcha.addEventListener(egret.Event.CHANGE,this.verifyCaptcha,this),this._phoneNum.addEventListener(eui.UIEvent.FOCUS_OUT,this.hidephonevc,this),this._captcha.addEventListener(eui.UIEvent.FOCUS_OUT,this.hidephonevc,this)},i.prototype.onBind=function(t){var e=t.param;e.userInfo.phonenumber?(this.setData(Number(e.userInfo.phonenumber)),uniLib.UserInfo.phonenumber=Number(e.userInfo.phonenumber)):(this.setData(0),uniLib.UserInfo.phonenumber=void 0)},i.prototype.removeEvent=function(){uniLib.Global.removeEventListener(t.MyInfoConst.GET_INFO,this.onBind,this),uniLib.Global.removeEventListener(t.MyInfoConst.PHONE_BIND,this.backHander,this),this._back.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.backHander,this),this._confirm.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmHandle,this),this._relieve.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmHandle,this),this._sendCaptcha.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.getCaptcha,this),this._phoneNum.removeEventListener(egret.Event.CHANGE,this.verifyPhone,this),this._captcha.removeEventListener(egret.Event.CHANGE,this.verifyCaptcha,this),this._phoneNum.removeEventListener(eui.UIEvent.FOCUS_OUT,this.hidephonevc,this),this._captcha.removeEventListener(eui.UIEvent.FOCUS_OUT,this.hidephonevc,this)},i.prototype.verifyPhone=function(){var t=this._phoneNum.text.trim();this.phone=null,/^1[3456789]\d{9}$/.test(t)?(this.phone=t,this._sendCaptcha.enabled=!0):this.phone=null,this._sendCaptcha.enabled=!0},i.prototype.verifyCaptcha=function(){var t=this._captcha.text.trim();/^\d{6}$/.test(t)?this.code=Number(this._captcha.text.trim()):this.code=0},i.prototype.confirmHandle=function(t){var e=1;if(t.target==this._relieve&&(e=2),0==this.code)uniLib.TipsUtils.showTipsDownToUp("请重新输入验证码");else if(NetMgr.ws){var i=new Cmd.BindingMobilePhoneLobbyCmd_C;i.opType=e,i.phoneNumber=Number(this.phone),i.code=this.code,NetMgr.tcpSend(i)}else uniLib.TipsUtils.showTipsDownToUp("请先获取验证码")},i.prototype.getCaptcha=function(){if(this._confirm.visible){var t=this._phoneNum.text.trim();if(!/^1[3456789]\d{9}$/.test(t))return void uniLib.TipsUtils.showTipsDownToUp("请输入正确的手机号")}if(this.phone||0!=Number(this._phoneTxt.text)){if(NetMgr.ws){var e=new Cmd.GetIdentifyingCodeLobbyCmd_C;0!=Number(this._phoneTxt.text)?(e.phoneNumber=Number(this._phoneTxt.text),e.opType=2):(e.phoneNumber=parseInt(this.phone),e.opType=1),NetMgr.tcpSend(e)}else{var i=uniLib.Global.gameConfig;NetMgr.init(i.login_url,i.gameid,i.zoneid),NetMgr.GetPhoneCode(this.phone,"",function(t){return t&&0==t.retcode?uniLib.TipsUtils.showTipsDownToUp("发送成功"):uniLib.TipsUtils.showTipsDownToUp("短信发送速度过快,请稍等"),!0},this)}this.startCount()}},i.prototype.backHander=function(){uniLib.PopUpMgr.removePopUp(this)},i.prototype.startCount=function(){this.code=0,this._captcha.text="",this._sendCaptcha.enabled=!1,this._sendCaptcha.visible=!1,this._count.visible=!0,this.timer=new egret.Timer(1e3),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.start()},i.prototype.timerFunc=function(){this.count>0?(this.count--,this._count.text="验证码已发送("+this.count+")"):(this.timer.stop(),this.timer=null,this._sendCaptcha.visible=!0,this._sendCaptcha.enabled=!0,this._count.visible=!1,this.count=60)},i.prototype.hidephonevc=function(){uniLib.ZQGameSdk.hideVk()},i}(eui.Component);t.BindPhoneVC=e,__reflect(e.prototype,"myInfo.BindPhoneVC")}(myInfo||(myInfo={}));var myInfo;!function(t){var e=function(){function t(){}return t.RES_JSON="resource/myInfo/myInfo.res_e4edcb80.json",t.THM_JSON="resource/myInfo/gameEui_33060c5e.json",t.PUB_MYINFO="pub_myInfo",t.PHONE_BIND="PHONE_BIND",t.GET_INFO="GET_INFO",t}();t.MyInfoConst=e,__reflect(e.prototype,"myInfo.MyInfoConst")}(myInfo||(myInfo={}));var Cmd;!function(t){function e(t){0==t.resultCode&&uniLib.Global.dispatchEvent(myInfo.MyInfoConst.PHONE_BIND,t)}t.OnBindingMobilePhoneLobbyCmd_S=e}(Cmd||(Cmd={}));var myInfo;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i._info=t,i.skinName="MyInfoVCSkin",i}return __extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEvent(),this.init()},i.prototype.init=function(){var t=this._info.userInfo;this.head_img.source=t.headUrl,this.nickName_lbl.text="昵称："+t.nickname,this.account_lbl.text="账号："+t.uid,"男"==t.gender?this.boy_rbtn.selected=!0:this.girl_rbtn.selected=!0,t.phonenumber?this.tips_lbl.visible=!1:this.tips_lbl.visible=!0,this.position_lbl.text="位置："+t.loc,t.signature&&(this.sign_etxt.text=t.signature,this.sign_btn.x=this.sign_etxt.x+this.sign_etxt.width+5,this.sign_etxt.width+=60);var e=this._info.gameRecord;e&&(this.allNum_lbl.text="总对局："+e.totalRound,this.winStreak_lbl.text="最高连胜数："+e.winStreak,this.rate_lbl.text="胜率："+e.winPercent+"%",this.todayWin_lbl.text="今日胜场："+e.todayWin,this.rank_btn.label="x"+e.topThree,this.eliminate_btn.label="x"+e.eliminateNum,this.reward_btn.label="x"+e.drawAll+"元",this.rushNum_btn.label="x"+e.rushRound),uniLib.Global.isInGame?(this.gift_grp.visible=!0,this.tips_lbl.visible=!1,this.phone_btn.visible=!1):(this.gift_grp.visible=!1,this.tips_lbl.visible=!0,this.phone_btn.visible=!0),(t.uid!=uniLib.UserInfo.uid||uniLib.Global.isInGame)&&(this.tips_lbl.visible=!1,this.phone_btn.visible=!1,this.sign_btn.visible=!1,this.sign_etxt.touchEnabled=!1,"男"==t.gender?this.girl_rbtn.visible=!1:this.boy_rbtn.visible=!1,this.girl_rbtn.x=this.boy_rbtn.x),1==uniLib.Global.is_sandbox&&uniLib.Global.isWxGame()&&(this.tips_lbl.visible=!1,this.phone_btn.visible=!1),(6==uniLib.Global.platId||15==uniLib.Global.platId)&&(this.tips_lbl.visible=!1,this.phone_btn.visible=!1)},i.prototype.openBind=function(){this.closeInfo(),uniLib.PopUpMgr.addPopUp(t.BindPhoneVC,null,!0,!0,0,uniLib.PopUpEffect.CENTER,0,0,uniLib.UserInfo.phonenumber?uniLib.UserInfo.phonenumber:null)},i.prototype.addEvent=function(){this.phone_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openBind,this),this.close_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeInfo,this),this.gift_grp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGift,this)},i.prototype.removeEvent=function(){this.phone_btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.openBind,this),this.close_btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeInfo,this),this.gift_grp.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onGift,this)},i.prototype.onGift=function(t){var e,i=(t.target,this.gift_grp.globalToLocal(t.stageX,t.stageY));i.x<87?e=3:i.x>99&&i.x<186?e=4:i.x>198&&i.x<285?e=5:i.x>297&&i.x<384&&(e=6);var n=new Cmd.SendGiftPokerCmd_C,s=new Cmd.GiftsInfo;s.giftsId=e,s.giftsNum=1,this._info.userInfo.uid==uniLib.UserInfo.uid?(s.toUid=0,s.fromUid=uniLib.UserInfo.uid):(s.toUid=this._info.userInfo.uid,s.fromUid=uniLib.UserInfo.uid),n.gift=s,uniLib.NetMgr.tcpSend(n),uniLib.PopUpMgr.removePopUp(this)},i.prototype.closeInfo=function(){if(this._info&&this._info.userInfo.uid==uniLib.UserInfo.uid){var t=this.boy_rbtn.selected?"男":"女";if(this.sign_etxt.text!=uniLib.UserInfo.signature&&"暂未设置签名"!=this.sign_etxt.text&&this.sign_etxt.text.length<=15){var e=new Cmd.UserInfoModifyRequestLobyCmd_C;e.signature=this.sign_etxt.text,e.gender=t,NetMgr.tcpSend(e)}else if(t!=uniLib.UserInfo.gender){var e=new Cmd.UserInfoModifyRequestLobyCmd_C;e.gender=t,NetMgr.tcpSend(e)}}uniLib.PopUpMgr.removePopUp(this)},i.prototype.destory=function(){this.removeEvent(),this._info=null,this.head_img.texture&&this.head_img.texture.dispose(),this.head_img=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeAllChildren(this)},i}(eui.Component);t.MyInfoVC=e,__reflect(e.prototype,"myInfo.MyInfoVC")}(myInfo||(myInfo={}));