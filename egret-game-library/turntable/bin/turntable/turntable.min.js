var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},turntable;!function(t){var e=function(){function t(){}return t.RES_JSON="resource/turntable/turntable.res_edf503be.json",t.THM_JSON="resource/turntable/gameEui_ba352d12.json",t.PUB_TURNTABLE="pub_turntable",t}();t.TurntableConsts=e,__reflect(e.prototype,"turntable.TurntableConsts")}(turntable||(turntable={}));var turntable;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(t,e){var n=new egret.BitmapText;n.font=RES.getRes("turntable_font_fnt"),n.text=t>1e4?t/1e4+"万":t+"";var i=new egret.Bitmap(RES.getRes("lb_zp_gift_"+e+"_png"));n.x=i.width-n.width>>1,this.addChild(n),i.y=n.height,this.addChild(i),this.anchorOffsetX=this.width>>1,this.anchorOffsetY=this.height>>1},e.prototype.init2=function(t){var e=new egret.Bitmap(RES.getRes("lb_zp2_"+t+"_png"));this.addChild(e),this.anchorOffsetX=this.width>>1,this.anchorOffsetY=this.height>>1},e}(egret.DisplayObjectContainer);t.TurntableItem=e,__reflect(e.prototype,"turntable.TurntableItem")}(turntable||(turntable={}));var turntable;!function(t){var e=function(e){function n(t){var n=e.call(this)||this;return n._info=t,n.skinName="TurntablePanelSkin",n}return __extends(n,e),n.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEvents();var n=RES.getRes("TableluckyTurntable_json");if(n)for(var i=0;i<n.length;i++)if(n[i].lobbyId==MJLobbyData.getInstance().lobbyId){for(var r=n[i].signReward,o=n[i].timeReward,a=new egret.Point(this.turn_grp.width>>1,this.turn_grp.height>>1),s=new egret.Point(this.turn1_grp.width>>1,this.turn1_grp.height>>1),l=0;l<r.length;l++){var h=360*l/8,u=Math.PI/180*(-h+90),_=new t.TurntableItem;_.init(r[l].count,l+1),_.rotation=h,_.x=a.x+130*Math.cos(u),_.y=a.y-130*Math.sin(u),this.turn_grp.addChild(_);var d=new t.TurntableItem;d.init2(o[l].time),d.rotation=h,d.x=s.x+140*Math.cos(u),d.y=s.y-140*Math.sin(u),this.turn1_grp.addChild(d)}break}if(this._timer=new egret.Timer(400,0),this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer.start(),this._info)if(this.left_lbl.textFlow=[{text:"剩余次数:"+this._info.remainder,style:{underline:!0}}],0==this._info.continueDay)this.lock_img.visible=!1,this.login_blbl.visible=!1;else{this.login_blbl.text="第"+this._info.continueDay+"日登录";var p=new egret.Sprite;p.graphics.beginFill(2752545,.6),p.graphics.drawCircle(this.turn1_grp.width/2,this.turn1_grp.height/2,this.turn1_grp.width/2),p.graphics.endFill(),this.turn1_grp.addChild(p)}else this.getReward(1)},n.prototype.addEvents=function(){uniLib.Global.addEventListener("turntableinfo",this.onUpdateInfo,this),this.close_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandle,this),this.luckDraw_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandle,this)},n.prototype.removeEvents=function(){uniLib.Global.removeEventListener("turntableinfo",this.onUpdateInfo,this),this.close_btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandle,this),this.luckDraw_btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandle,this)},n.prototype.onUpdateInfo=function(t){var e=this,n=t.param;if(this.left_lbl.textFlow=[{text:"剩余次数:"+n.remainder,style:{underline:!0}}],n.turnId){this.luckDraw_btn.enabled=!1;var i=360-45*(n.turnId-1);if(n.turnId2){var r=360-45*(n.turnId2-1);egret.Tween.get(this.turn1_grp).to({rotation:1080+r},3e3,egret.Ease.quadInOut)}egret.Tween.get(this.turn_grp).to({rotation:1080+i},3e3,egret.Ease.quartInOut).call(function(){e.turn_grp.rotation=e.turn_grp.rotation%360,e.luckDraw_btn.enabled=!0;var t=RES.getRes("TableluckyTurntable_json");if(t)for(var i=0;i<t.length;i++)if(t[i].lobbyId==MJLobbyData.getInstance().lobbyId){var r=t[i].signReward,o=new commonConfirm.ReWardDataVo;o.getDataByGoodId(r[n.turnId-1].goodsId,r[n.turnId-1].count*(n.turnId2?t[i].timeReward[n.turnId2-1].time:1));var a=new commonConfirm.RewardPanel;a.initData([o]),egret.MainContext.instance.stage.addChild(a);break}},this)}this._info=n},n.prototype.onTimer=function(t){var e=this._timer.currentCount;this.top_img.source="turntable_res_json.lb_zp_uplight"+(e%2?"_1_":"_")+"png",this.left_img.source="turntable_res_json.lb_zp_sidelight"+(e%2?"_":"_1_")+"png",this.right_img.source="turntable_res_json.lb_zp_sidelight"+(e%2?"_":"_1_")+"png",this._info&&0==this._info.continueDay&&(this.top1_img.source="turntable_res_json.lb_zp_uplight"+(e%2?"_1_":"_")+"png",this.left1_img.source="turntable_res_json.lb_zp_sidelight"+(e%2?"_":"_1_")+"png",this.right1_img.source="turntable_res_json.lb_zp_sidelight"+(e%2?"_":"_1_")+"png")},n.prototype.onTouchHandle=function(t){var e=this,n=t.target;if(n==this.close_btn)uniLib.PopUpMgr.removePopUp(this);else if(n==this.luckDraw_btn&&(1==this._info.type?this.getReward(2):2==this._info.type&&(wxgame.Global.instance.videoAdCanUse?wxgame.Global.instance.createRewardedVideoAd(null,function(){e.getReward(2)},this):this._info.type=3),3==this._info.type)){var i=new uniLib.WXShareVo;i.shareType=Cmd.ShareType.luckyturn,wxgame.ShareMessage.instance.shareAppMessage(i,function(){e.getReward(2)},null,this)}},n.prototype.getReward=function(t){var e=new Cmd.GetInfoTurnTableCmd_C;e.opType=t,NetMgr.tcpSend(e)},n.prototype.destroy=function(){this._info=null,this._timer&&(this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this)),this._timer=null,this.turn_grp.removeChildren(),egret.Tween.removeTweens(this.turn_grp),egret.Tween.removeTweens(this.turn1_grp),this.removeEvents()},n}(eui.Component);t.TurntablePanel=e,__reflect(e.prototype,"turntable.TurntablePanel")}(turntable||(turntable={}));var turntable;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(t,e){var n=new egret.BitmapText;n.font=RES.getRes("turntable_font_fnt"),n.text=t>1e4?t/1e4+"万":t+"";var i=new egret.Bitmap(RES.getRes("game_prop_json.bag_daoju_"+e));commonConfirm.ResUtil.limitImageSize(i,60),n.x=i.width-n.width>>1,this.addChild(n),i.y=n.height,this.addChild(i),this.anchorOffsetX=this.width>>1,this.anchorOffsetY=this.height>>1},e}(egret.DisplayObjectContainer);t.NewTurntableItem=e,__reflect(e.prototype,"turntable.NewTurntableItem")}(turntable||(turntable={}));var turntable;!function(t){var e=function(e){function n(t){var n=e.call(this)||this;return n._info=t,n.skinName="NewTurntablePanelSkin",n}return __extends(n,e),n.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEvents();var n=RES.getRes("TableluckyTurntable_json");if(n)for(var i=0;i<n.length;i++)if(n[i].lobbyId==MJLobbyData.getInstance().lobbyId){for(var r=n[i].onlineReward,o=new egret.Point(this.turn_grp.width>>1,this.turn_grp.height>>1),a=0;a<r.length;a++){var s=360*a/8,l=Math.PI/180*(-s+90),h=new t.NewTurntableItem;h.init(r[a].count,r[a].goodsId),h.rotation=s,h.x=o.x+130*Math.cos(l),h.y=o.y-130*Math.sin(l),this.turn_grp.addChild(h)}break}this._timer=new egret.Timer(400,0),this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer.start(),null==this._info&&this.getReward(3)},n.prototype.addEvents=function(){uniLib.Global.addEventListener("turntableinfo",this.onUpdateInfo,this),this.close_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandle,this),this.luckDraw_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandle,this)},n.prototype.removeEvents=function(){uniLib.Global.removeEventListener("turntableinfo",this.onUpdateInfo,this),this.close_btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandle,this),this.luckDraw_btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandle,this)},n.prototype.onUpdateInfo=function(t){var e=this,n=t.param;if(n.turnId){this.luckDraw_btn.enabled=!1;var i=360-45*(n.turnId-1);egret.Tween.get(this.turn_grp).to({rotation:1080+i},3e3,egret.Ease.quartInOut).call(function(){e.turn_grp.rotation=e.turn_grp.rotation%360;var t=RES.getRes("TableluckyTurntable_json");if(t)for(var i=0;i<t.length;i++)if(t[i].lobbyId==MJLobbyData.getInstance().lobbyId){var r=t[i].onlineReward,o=new Cmd.RewardItem;o.goodId=r[n.turnId-1].goodsId,o.goodNbr=r[n.turnId-1].count;var a=new commonConfirm.RewardPanel;a.initData2([o]),uniLib.Global.isInGame?(a.scaleX=LobbyModuleMgr.getInstance().panelScaleX,uniLib.PopUpMgr.addPopUp(a,null,!0,!0,0,uniLib.PopUpEffect.NOMAL,1280*a.scaleX,720)):uniLib.PopUpMgr.addPopUp(a,null,!0,!0,0),egret.setTimeout(function(){e._info&&uniLib.PopUpMgr.removePopUp(e)},e,1200);break}},this)}this._info=n},n.prototype.onTimer=function(t){var e=this._timer.currentCount;this.top_img.source="turntable_res_json.lb_zp_uplight"+(e%2?"_1_":"_")+"png",this.left_img.source="turntable_res_json.lb_zp_sidelight"+(e%2?"_":"_1_")+"png",this.right_img.source="turntable_res_json.lb_zp_sidelight"+(e%2?"_":"_1_")+"png"},n.prototype.onTouchHandle=function(t){var e=t.target;e==this.close_btn?uniLib.PopUpMgr.removePopUp(this):e==this.luckDraw_btn&&this.getReward(4)},n.prototype.getReward=function(t){var e=new Cmd.GetInfoTurnTableCmd_C;e.opType=t,NetMgr.tcpSend(e)},n.prototype.destroy=function(){this._info=null,this._timer&&(this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this)),this._timer=null,this.turn_grp.removeChildren(),egret.Tween.removeTweens(this.turn_grp),this.removeEvents()},n}(eui.Component);t.NewTurntablePanel=e,__reflect(e.prototype,"turntable.NewTurntablePanel")}(turntable||(turntable={}));var Cmd;!function(t){function e(t){return t.opType>2?void uniLib.Global.dispatchEvent("turntableinfo",t):void(uniLib.PopUpMgr.hasPopup(turntable.TurntablePanel)?uniLib.Global.dispatchEvent("turntableinfo",t):LoadPanelTipMgr.getInstance().loadRes(turntable.TurntableConsts.PUB_TURNTABLE,function(){uniLib.PopUpMgr.addPopUp(turntable.TurntablePanel,null,!0,!0,0,uniLib.PopUpEffect.CENTER,0,0,t)}))}t.OnGetInfoTurnTableCmd_S=e}(Cmd||(Cmd={}));