var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);n.prototype=t.prototype,e.prototype=new n},exchange;!function(e){var t=function(){function e(){}return e.RES_JSON="resource/exchange/exchange.res_3af3676b.json",e.THM_JSON="resource/exchange/gameEui_57791846.json",e.PUB_EXCHANGE="pub_exchange",e.EXCHANGE_FARE="EXCHANGE_FARE",e.FARE_INFO="FARE_INFO",e.DRAW_INFO="DRAW_INFO",e}();e.ExchangeConst=t,__reflect(t.prototype,"exchange.ExchangeConst")}(exchange||(exchange={}));var exchange;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="ExchangeItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this.data;this.name=t.shopId.toString(),this.click_btn.des_lbl.text=t.shopName,this.click_btn.cost_blbl.text=t.price;var n=t.type;2==n?(this.click_btn.icon_img.source="dh_hongbao_"+t.shopId+"_png",this.tip_lbl.visible=!1,this.tpsBg_img.visible=!1):1==n?(this.click_btn.icon_img.source="dh_jinbi_"+t.shopId+"_png",this.tip_lbl.visible=!1,this.tpsBg_img.visible=!1):3==n&&(this.click_btn.icon_img.source="exchange_fare_"+t.shopId+"_png",this.tip_lbl.visible=!0,this.tpsBg_img.visible=!0)},t}(eui.ItemRenderer);e.ExchangeItem=t,__reflect(t.prototype,"exchange.ExchangeItem")}(exchange||(exchange={}));var exchange;!function(e){var t=function(t){function n(e,n){void 0===e&&(e=0);var i=t.call(this)||this;return i._selectIndex=e,i._customerQQ=n,i.width=uniLib.Global.screenWidth,i.skinName="ExchangeVCSkin",i}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),uniLib.Global.screenWidth>this.bg_img.width&&(this.bg_img.width=uniLib.Global.screenWidth),this._customerQQ?this.tips_lbl.textFlow=[{text:"（兑换可能有几分钟延时，请耐心等待。如未到账，请",style:{textColor:16777215}},{text:"联系客服QQ："+this._customerQQ,style:{underline:!0,textColor:1331367}},{text:"）",style:{textColor:16777215}}]:this.tips_lbl.textFlow=[{text:"（兑换可能有几分钟延时，请耐心等待。如未到账，请",style:{textColor:16777215}},{text:"联系客服",style:{underline:!0,textColor:1331367}},{text:"）",style:{textColor:16777215}}],this.send(),this.addEvent(),this._collArr=new eui.ArrayCollection,this.exchange_lst.itemRenderer=e.ExchangeItem,this.exchange_lst.dataProvider=this._collArr,uniLib.Global.isNative?(this.package_rbtn.visible=!1,this.ticket_rbtn.visible=!0):(this.package_rbtn.visible=!0,this.ticket_rbtn.visible=!1),uniLib.Global.isWxGame()&&(1==uniLib.Global.is_sandbox||uniLib.UserInfo.giftCoupon<uniLib.Global.defaultConfig.exchange)&&(this._selectIndex=0,this.package_rbtn.visible=!1),uniLib.Global.isNative&&0!=uniLib.Global.is_sandbox&&(this._selectIndex=0,this.package_rbtn.visible=!1,this.ticket_rbtn.visible=!1),0==this._selectIndex?this.diamond_rbtn.selected=!0:1==this._selectIndex&&(this.package_rbtn.visible&&(this.package_rbtn.selected=!0),this.ticket_rbtn.visible&&(this.ticket_rbtn.selected=!0)),this.refreshList()},n.prototype.send=function(){var e=new Cmd.GetExchangeGiftVoucherInfo_C;NetMgr.tcpSend(e)},n.prototype.updateIndex=function(e){},n.prototype.onTouchHander=function(e){e.target==this.tips_lbl?this._customerQQ&&uniLib.Global.isNative?(uniLib.ZQGameSdk.nativeCopyStr(this._customerQQ),uniLib.TipsUtils.showTipsDownToUp("客服QQ复制成功")):wxgame.Global.instance.openCustomerServiceConversation(!0,wxgame.CustomerServiceConst.DEFAULTTITLE,wxgame.Global.instance.shareIconUrl+"shareIcons/common.jpg"):e.target==this._closeBtn&&this.closeInfo()},n.prototype.refreshList=function(){var e=1,t=ConfigMgr.getInstance().getGameListCfgById(MJLobbyData.getInstance().lobbyId),n=t.diamondshopList;this.diamond_rbtn.selected?(e=1,n=t.diamondshopList):this.package_rbtn.selected?(e=2,n=t.newshopList):this.ticket_rbtn.selected&&(e=3,n=t.channelExchange);for(var i=[],s=0;s<n.length;s++){var o=ConfigMgr.getInstance().getShopCfgById(n[s]);o.type=e,i.push(o)}this._collArr.replaceAll(i),this.exchange_lst.validateNow(),this.updateIndex()},n.prototype.onItemTapHandler=function(e){var t=this.exchange_lst.selectedItem;if(t.price>uniLib.UserInfo.giftCoupon)uniLib.TipsUtils.showTipsDownToUp("福卡不足,请去赢取更多福卡");else{var n=t.type;if(1==n){var i=new Cmd.BuyGoodsLobbyCmd_C;i.shopId=t.shopId,i.shopNbr=1,NetMgr.tcpSend(i)}else if(2==n||3==n)if(uniLib.UserInfo.phonenumber)if(uniLib.Global.isWxGame()&&1==MJLobbyData.getInstance().userInfoSynLobby.loginByOpenId)LobbyModuleMgr.getInstance().showAuthonPanel();else{var i=new Cmd.BuyGoodsLobbyCmd_C;i.shopId=t.shopId,i.shopNbr=1,NetMgr.tcpSend(i)}else this.openBind()}},n.prototype.openBind=function(){uniLib.PopUpMgr.addPopUp(myInfo.BindPhoneVC,null,!0,!0,0,uniLib.PopUpEffect.CENTER,0,0,uniLib.UserInfo.phonenumber?uniLib.UserInfo.phonenumber:null)},n.prototype.addEvent=function(){uniLib.Global.addEventListener(e.ExchangeConst.FARE_INFO,this.updateIndex,this),this._closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHander,this),this.tips_lbl.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHander,this),this.diamond_rbtn.group.addEventListener(eui.UIEvent.CHANGE,this.refreshList,this),this.exchange_lst.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTapHandler,this)},n.prototype.removeEvent=function(){uniLib.Global.removeEventListener(e.ExchangeConst.FARE_INFO,this.updateIndex,this),this._closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHander,this),this.tips_lbl.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHander,this),this.diamond_rbtn.group.removeEventListener(eui.UIEvent.CHANGE,this.refreshList,this),this.exchange_lst.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTapHandler,this)},n.prototype.closeInfo=function(){uniLib.PopUpMgr.removePopUp(this)},n.prototype.destory=function(){this.removeEvent(),this._collArr=null,this._giftVoucher=null,uniLib.DisplayUtils.removeAllChildren(this),uniLib.DisplayUtils.removeAllChildren(this)},n}(eui.Component);e.ExchangeVC=t,__reflect(t.prototype,"exchange.ExchangeVC")}(exchange||(exchange={}));var Cmd;!function(e){function t(e){0==e.resultCode&&(uniLib.Global.dispatchEvent(exchange.ExchangeConst.EXCHANGE_FARE,e),wxgame.Global.instance.aldSendEvent("周边系统","兑换话费shopId"+e.shopId+"成功"))}function n(e){uniLib.Global.dispatchEvent(exchange.ExchangeConst.FARE_INFO,e)}function i(e){e.resultCode||wxgame.Global.instance.aldSendEvent("周边系统","兑换钻石shopId"+e.shopId+"成功")}function s(e){e.resultCode||uniLib.Global.dispatchEvent(exchange.ExchangeConst.DRAW_INFO,e)}e.OnExchangeGiftVoucherRecordUserInfoLobby_S=t,e.OnGetExchangeGiftVoucherInfo_S=n,e.OnBuyGoodsLobbyCmd_S=i,e.OnOpenRedPackLobbyCmd_S=s}(Cmd||(Cmd={}));