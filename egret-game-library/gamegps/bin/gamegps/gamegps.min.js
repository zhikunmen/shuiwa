var __reflect=this&&this.__reflect||function(e,t,s){e.__class__=t,s?s.push(t):s=[t],e.__types__=e.__types__?s.concat(e.__types__):s},__extends=this&&this.__extends||function(e,t){function s(){this.constructor=e}for(var _ in t)t.hasOwnProperty(_)&&(e[_]=t[_]);s.prototype=t.prototype,e.prototype=new s},gamegps;!function(e){var t=function(){function e(){}return e.RES_JSON="resource/gamegps/gamegps.res_960793f5.json",e.THM_JSON="resource/gamegps/gameEui_ba2da8.json",e.GAME_GPS="game_gps",e}();e.GameGpsConst=t,__reflect(t.prototype,"gamegps.GameGpsConst")}(gamegps||(gamegps={}));var gamegps;!function(e){var t=function(t){function s(){var e=t.call(this,"chaguan_gps_title_png",1009,622)||this;return e.eleMap=new Map,e.distanceMap=new Map,e.userVoList=[],e.isWarn=!1,e.hasPopUpUidArr=[],e.skinName="GpsPanel",e}return __extends(s,t),s.prototype.createChildren=function(){t.prototype.createChildren.call(this)},s.prototype.initUI=function(){this._btn_continue.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeGPS,this),this._btn_leave.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeave,this),this.reset()},s.prototype.closeGPS=function(){uniLib.PopUpMgr.removePopUp(this)},s.prototype.onLeave=function(){this.dispatchEventWith(e.GameGpsUIEventConsts.DISMISS_GAME)},s.prototype.reset=function(){switch(e.GameGpsData.getInstance().playerNumber){case 2:this._user_name_2_1.visible=!1,this._user_name_2_2.visible=!1,this._user_headImg_2_1.source="chaguan_gps_head_bg_png",this._user_headImg_2_2.source="chaguan_gps_head_bg_png",this._distance_group_2_1.visible=!1;break;case 3:this._user_name_3_1.visible=!1,this._user_name_3_2.visible=!1,this._user_name_3_3.visible=!1,this._user_headImg_3_1.source="chaguan_gps_head_bg_png",this._user_headImg_3_2.source="chaguan_gps_head_bg_png",this._user_headImg_3_3.source="chaguan_gps_head_bg_png",this._distance_group_3_1.visible=!1,this._distance_group_3_2.visible=!1,this._distance_group_3_3.visible=!1;break;case 4:this._user_name_4_1.visible=!1,this._user_name_4_2.visible=!1,this._user_name_4_3.visible=!1,this._user_name_4_4.visible=!1,this._user_headImg_4_1.source="chaguan_gps_head_bg_png",this._user_headImg_4_2.source="chaguan_gps_head_bg_png",this._user_headImg_4_3.source="chaguan_gps_head_bg_png",this._user_headImg_4_4.source="chaguan_gps_head_bg_png",this._distance_group_4_1.visible=!1,this._distance_group_4_2.visible=!1,this._distance_group_4_3.visible=!1,this._distance_group_4_4.visible=!1,this._distance_group_4_5.visible=!1,this._distance_group_4_6.visible=!1}this.isWarn=!1,this._tip_ok_group.visible=!1,this._tip_warn_group.visible=!1,this.eleMap=new Map,this.distanceMap=new Map,this.userVoList=[]},s.prototype.initPanel=function(){switch(e.GameGpsData.getInstance().playerNumber){case 2:this._fourPeople.visible=!1,this._threePeple.visible=!1,this._twoPeople.visible=!0,this._line_2.visible=!0,this._user_group_2_1.visible=!0,this._user_group_2_2.visible=!0,this._user_name_2_1.visible=!1,this._user_name_2_2.visible=!1;var t=new Map;t.set("bg",this._distance_bg_2_1),t.set("txt",this._distance_txt_2_1),t.set("group",this._distance_group_2_1),this.distanceMap.set("12",t);break;case 3:this._twoPeople.visible=!1,this._fourPeople.visible=!1,this._threePeple.visible=!0,this._line_3.visible=!0,this._user_group_3_1.visible=!0,this._user_group_3_2.visible=!0,this._user_group_3_3.visible=!0,this._user_name_3_1.visible=!1,this._user_name_3_2.visible=!1,this._user_name_3_3.visible=!1;var s=new Map;s.set("bg",this._distance_bg_3_1),s.set("txt",this._distance_txt_3_1),s.set("group",this._distance_group_3_1),this.distanceMap.set("12",s);var _=new Map;_.set("bg",this._distance_bg_3_2),_.set("txt",this._distance_txt_3_2),_.set("group",this._distance_group_3_2),this.distanceMap.set("13",_);var i=new Map;i.set("bg",this._distance_bg_3_3),i.set("txt",this._distance_txt_3_3),i.set("group",this._distance_group_3_3),this.distanceMap.set("23",i);break;case 4:this._twoPeople.visible=!1,this._threePeple.visible=!1,this._fourPeople.visible=!0,this._line_4.visible=!0,this._user_group_4_1.visible=!0,this._user_group_4_2.visible=!0,this._user_group_4_3.visible=!0,this._user_group_4_4.visible=!0,this._user_name_4_1.visible=!1,this._user_name_4_2.visible=!1,this._user_name_4_3.visible=!1,this._user_name_4_4.visible=!1;var a=new Map;a.set("bg",this._distance_bg_4_2),a.set("txt",this._distance_txt_4_2),a.set("group",this._distance_group_4_2),this.distanceMap.set("12",a);var n=new Map;n.set("bg",this._distance_bg_4_6),n.set("txt",this._distance_txt_4_6),n.set("group",this._distance_group_4_6),this.distanceMap.set("13",n);var r=new Map;r.set("bg",this._distance_bg_4_3),r.set("txt",this._distance_txt_4_3),r.set("group",this._distance_group_4_3),this.distanceMap.set("14",r);var h=new Map;h.set("bg",this._distance_bg_4_4),h.set("txt",this._distance_txt_4_4),h.set("group",this._distance_group_4_4),this.distanceMap.set("23",h);var p=new Map;p.set("bg",this._distance_bg_4_5),p.set("txt",this._distance_txt_4_5),p.set("group",this._distance_group_4_5),this.distanceMap.set("24",p);var o=new Map;o.set("bg",this._distance_bg_4_1),o.set("txt",this._distance_txt_4_1),o.set("group",this._distance_group_4_1),this.distanceMap.set("34",o)}for(var g=1,u=0,c=e.GameGpsData.getInstance().userList;u<c.length;u++){var l=c[u],d=new Map,b="_user_group_"+e.GameGpsData.getInstance().playerNumber+"_"+g,v="_user_headImg_"+e.GameGpsData.getInstance().playerNumber+"_"+g,m="_user_name_"+e.GameGpsData.getInstance().playerNumber+"_"+g;d.set("group",this[b]),d.set("headImg",this[v]),d.set("userName",this[m]),this.eleMap.set(g,d),this.userVoList[g]=l,this.addShowPlayer(l,g),g++}this.showDistanceAll()},s.prototype.addShowPlayer=function(e,t){var s=this.eleMap.get(t),_=s.get("headImg");_.source=e.headUrl;var i=s.get("userName");i.text=e.nickName,i.visible=!0},s.prototype.showDistanceAll=function(){var e=this,t=[];this.userVoList.forEach(function(s,_,i){i.forEach(function(s,i){var a=[_,i].sort(function(e,t){return e-t}),n=a.join("");e.distanceMap.has(n)&&-1==t.indexOf(n)&&(e.showDistance(n,_,i),t.push(n))})}),this.isWarn?(this._tip_warn_group.visible=!0,this._tip_ok_group.visible=!1):(this._tip_warn_group.visible=!1,this._tip_ok_group.visible=!0)},s.prototype.showDistance=function(e,t,s){var _=this.userVoList[t],i=this.userVoList[s],a=uniLib.Utils.getDistance(_.lat,_.lng,i.lat,i.lng);a?300>=a?(this.distanceMap.get(e).get("bg").source="chaguan_gps_distance_bg_red_png",this.distanceMap.get(e).get("txt").text=a.toFixed(1)+"米",this.isWarn=!0,this.hasPop(_,i)):(this.distanceMap.get(e).get("bg").source="chaguan_gps_distance_bg_green_png",1e3>=a?this.distanceMap.get(e).get("txt").text=a.toFixed(1)+"米":this.distanceMap.get(e).get("txt").text=(a/1e3).toFixed(1)+"公里"):(this.distanceMap.get(e).get("bg").source="chaguan_gps_distance_bg_red_png",this.distanceMap.get(e).get("txt").text="?"),this.distanceMap.get(e).get("group").visible=!0},s.prototype.hasPop=function(e,t){var s=[e.uid,t.uid].sort(function(e,t){return e-t}),_=!1;this.hasPopUpUidArr.length&&this.hasPopUpUidArr.forEach(function(e,t){return e[0]==s[0]&&e[1]==s[1]?void(_=!0):void 0}),_||this.hasPopUpUidArr.push(s)},s.prototype.destroy2=function(){this._btn_continue.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeGPS,this),this._btn_leave.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeave,this),uniLib.DisplayUtils.removeFromParent(this)},s}(commonpanel.LobbyBaseEuiPanel);e.GameGpsPanel=t,__reflect(t.prototype,"gamegps.GameGpsPanel");var s=function(){function e(){}return e}();e.UserVo=s,__reflect(s.prototype,"gamegps.UserVo")}(gamegps||(gamegps={}));var gamegps;!function(e){var t=function(){function e(){}return e.DISMISS_GAME="DISMISS_GAME",e.SHOW_GPS="SHOW_GPS",e}();e.GameGpsUIEventConsts=t,__reflect(t.prototype,"gamegps.GameGpsUIEventConsts");var s=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e}();e.GameGpsData=s,__reflect(s.prototype,"gamegps.GameGpsData")}(gamegps||(gamegps={}));