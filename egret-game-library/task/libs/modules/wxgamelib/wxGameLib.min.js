/*!
 * wxGameLib - compressed JS
 * @licence wxGameLib - v0.1.0 (2018-10-29)
 *  qq:93749937 | Licence: helojo
 */

!function(e){var n=function(){function e(){}return e.DEVELOP="develop",e.TRIAL="trial",e.RELEASE="release",e}();e.envVersionConst=n;var t=function(){function e(){}return e.DEFAULTTITLE='回复"关注"获取关注链接',e}();e.CustomerServiceConst=t}(wxgame||(wxgame={}));var __awaiter=this&&this.__awaiter||function(r,a,s,c){return new(s||(s=Promise))(function(e,n){function t(e){try{o(c.next(e))}catch(e){n(e)}}function i(e){try{o(c.throw(e))}catch(e){n(e)}}function o(n){n.done?e(n.value):new s(function(e){e(n.value)}).then(t,i)}o((c=c.apply(r,a||[])).next())})},__generator=this&&this.__generator||function(t,i){var o,r,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=i.call(t,s)}catch(e){n=[6,e],r=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}};!function(s){var e=function(){function e(){var n=this;this.isFirst=!0,this.bannerUnitIdArr=["adunit-1b42952355975af0"],this.onLoadBanner=function(){n._bannerAd&&n._bannerAd.show()},this.videoUnitIdArr=["adunit-ebbeeb9f7cbb945f"],this.onErrorVideo=function(e){uniLib.TipsUtils.showTipsDownToUp("视频组件尚未准备好"),console.log("视频拉取失败:"+JSON.stringify(e)),n._videoAd.load()},this.onCloseVideo=function(e){uniLib.SoundMgr.instance.resumeBgMusic(),e&&e.isEnded||null==e?n._videoCallFun&&n._videoCallFun.apply(n._vidoeCallObj):uniLib.TipsUtils.showTipsDownToUp("未观看完整视频不能获得奖励")}}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return s.Utils.isWxGame?(this.isFirst&&(this.isFirst=!1,s.Message.instance.init(),s.ShareMessage.instance.showShareMenu(!0)),[2,new Promise(function(n,t){wx.login({success:function(e){n(e),console.log("login success: "+e.code)},fail:function(e){t(!1),console.error("login fail: "+e)},complete:function(){}})})]):[2]})})},e.prototype.exitMiniProgram=function(t,i,o){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return s.Utils.isWxGame?[2,new Promise(function(e,n){wx.exitMiniProgram({success:function(){t&&t(),e(!0)},fail:function(){i&&i(),n(!1)},complete:o})})]:[2]})})},e.prototype.openCustomerServiceConversation=function(e,i,o){return void 0===i&&(i=s.CustomerServiceConst.DEFAULTTITLE),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return s.Utils.isWxGame?[2,new Promise(function(n,t){wx.openCustomerServiceConversation({sessionFrom:"",showMessageCard:!0,sendMessageTitle:i,sendMessagePath:"",sendMessageImg:o?0<o.match(/http/gi).length?o+s.Utils.getVersionControlCode():o:"",success:function(e){n(e)},fail:function(e){t(e)}})})]:[2]})})},e.prototype.navigateToMiniProgram=function(i,o,r,a){return void 0===o&&(o=""),void 0===r&&(r={}),void 0===a&&(a=s.envVersionConst.RELEASE),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.navigateToMiniProgram({appId:i,path:o,extraData:r,envVersion:a,success:function(e){n(e)},fail:function(e){console.error("navigateToMiniProgram fail"),t(e)}})})]})})},e.prototype.openSetting=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.openSetting({success:function(e){n(e)},fail:function(e){t(e),console.log("打开设置失败")}})})]})})},e.prototype.authorize=function(i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.authorize({scope:i,success:function(){n()},fail:function(){wx.showModal({title:"授权提示",content:"获取授权失败，请确认授权！",showCancel:!1,success:function(){s.Global.instance.openSetting().then(function(e){e[i]?n():uniLib.TipsUtils.showTipsDownToUp("授权失败请重试")},function(e){t(e)}).catch(function(e){t(e)})}})}})})]})})},e.prototype.onErrorBanner=function(e){uniLib.TipsUtils.showTipsDownToUp("广告组件尚未准备好"),console.log("广告拉取失败:"+JSON.stringify(e))},e.prototype.destroyBannerAd=function(){this._bannerAd&&(this._bannerAd.offError(this.onErrorBanner),this._bannerAd.offLoad(this.onLoadBanner),this._bannerAd.destroy())},e.prototype.createBannerAd=function(e,n){var t=this;uniLib.Global.isWxGame()&&(this._sysInfo||(this._sysInfo=wx.getSystemInfoSync()),this._sysInfo&&(this.destroyBannerAd(),this._bannerAd=wx.createBannerAd({adUnitId:e||this.bannerUnitIdArr[0],style:n||{left:(this._sysInfo.screenWidth-300)/2,top:this._sysInfo.screenHeight-86,width:300}}),this._bannerAd.onResize(function(e){t._bannerAd.style.top=t._sysInfo.screenHeight-t._bannerAd.style.realHeight}),this._bannerAd.onError(this.onErrorBanner),this._bannerAd.onLoad(this.onLoadBanner)))},e.prototype.createRewardedVideoAd=function(e,n,t){uniLib.Global.isWxGame()&&(this._videoAd?(this._videoCallFun=n,this._vidoeCallObj=t,this._videoAd.show().then(function(){uniLib.SoundMgr.instance.pauseBgMusic()},function(){uniLib.TipsUtils.showTipsDownToUp("视频组件尚未准备好")})):(this._videoAd=wx.createRewardedVideoAd({adUnitId:e||this.videoUnitIdArr[0]}),this._videoAd.onLoad(function(){console.log("视频加载完毕")}),this._videoAd.onError(this.onErrorVideo),this._videoAd.onClose(this.onCloseVideo)))},e}();s.Global=e}(wxgame||(wxgame={})),function(i){var e=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.launchOption=wx.getLaunchOptionsSync(),this.initLaunchOption(),this.addOnShowEvent()},e.prototype.initLaunchOption=function(){if(this.launchOption){var e,n=this.launchOption;n.query&&(e=n.query);var t=new uniLib.WXShareVo;t.opType=Cmd.ShareOpType.click,e.shareType&&(t.shareType=Number(e.shareType)),e.wgShareData&&(t.wgShareData=e.wgShareData),e&&e.uid&&(t.fromUid=Number(e.uid),n.shareTicket?i.ShareMessage.instance.getShareInfo(n.shareTicket).then(function(e){e&&0<=e.errMsg.indexOf("ok")&&(t.shareTicket=JSON.stringify(e),i.ShareMessage.instance.sendShareMessage(t))}).catch(function(e){console.log("获取群消息失败",e),uniLib.TipsUtils.showTipsDownToUp("获取群消息失败")}):i.ShareMessage.instance.sendShareMessage(t)),this.launchOption=null}},e.prototype.addOnShowEvent=function(){var n=this;wx.offShow(function(e){n.onShow(e)}),wx.onShow(function(e){n.onShow(e)})},e.prototype.onShow=function(e){!this.launchOption&&e&&(this.launchOption=e),this.initLaunchOption()},e.prototype.setUserCloudStorage=function(e){return new Promise(function(n,t){wx.setUserCloudStorage({KVDataList:e,success:function(e){console.log("setUserCloudStorage success",e),n(e)},fail:function(e){console.error("setUserCloudStorage success",e),t(e)}})})},e}();i.Message=e}(wxgame||(wxgame={})),function(n){var e=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.sendShareData=function(e){n.Utils.isWxGame&&(this._openDataContext=wx.getOpenDataContext(),this._openDataContext.postMessage(e))},e.prototype.createDisplayObject=function(e,n,t,i){var o=window.sharedCanvas;o.width=n,o.height=t;var r=new egret.BitmapData(o);r.$deleteSource=!1;var a=new egret.Texture;a._setBitmapData(r);var s=new egret.Bitmap(a);(s.width=n,s.height=t,s.y=i,"webgl"==egret.Capabilities.renderMode)&&(egret.wxgame.WebGLRenderContext.getInstance().context.wxBindCanvasTexture||egret.startTick(function(e){return egret.WebGLUtils.deleteWebGLTexture(r.webGLTexture),r.webGLTexture=null,!1},this));return s},e}();n.OpenData=e}(wxgame||(wxgame={}));var wxgame;__awaiter=this&&this.__awaiter||function(r,a,s,c){return new(s||(s=Promise))(function(e,n){function t(e){try{o(c.next(e))}catch(e){n(e)}}function i(e){try{o(c.throw(e))}catch(e){n(e)}}function o(n){n.done?e(n.value):new s(function(e){e(n.value)}).then(t,i)}o((c=c.apply(r,a||[])).next())})},__generator=this&&this.__generator||function(t,i){var o,r,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=i.call(t,s)}catch(e){n=[6,e],r=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}};!function(h){var e=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.onShareAppMessage=function(i,o,r){void 0===i&&(i=""),void 0===o&&(o=""),void 0===r&&(r=""),wx.onShareAppMessage(function(e){if(!i||""==i.trim()){var n=void 0,t=h.Global.instance.tableLobbyGameList;t&&Array.isArray(t.newshareContent)&&(n=Math.floor(Math.random()*t.newshareContent.length),i=t.newshareContent[n],"/"!=h.Global.instance.shareIconUrl[h.Global.instance.shareIconUrl.length-1]&&(h.Global.instance.shareIconUrl+="/"),o=h.Global.instance.shareIconUrl+"shareIcons/"+t.newsharepicture[n])}return console.log("用户点击事件"),{title:i,imageUrl:o,query:r}})},e.prototype.showShareMenu=function(i){return void 0===i&&(i=!0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.showShareMenu({withShareTicket:i,success:function(e){console.log("showShareMenu success:  "+e),n(!0)},fail:function(e){console.log("showShareMenu fail:  "+e),t(!1)},complete:function(){}})})]})})},e.prototype.hideShareMenu=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.hideShareMenu({success:function(e){console.log("hideShareMenu success:  "+e),n(!0)},fail:function(e){console.log("hideShareMenu fail:  "+e),t(!1)},complete:function(){}})})]})})},e.prototype.updateShareMenu=function(i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.updateShareMenu({withShareTicket:i,success:function(e){console.log("updateShareMenu success:  "+e),n(!0)},fail:function(e){console.log("updateShareMenu fail:  "+e),t(!1)},complete:function(){}})})]})})},e.prototype.shareAppMessage=function(s,c,u){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,r,a;return __generator(this,function(e){return i=t="",(o=h.Global.instance.tableLobbyGameList)&&Array.isArray(o.newshareContent)&&(n=Math.floor(Math.random()*o.newshareContent.length)),s.title?t=s.title:isNaN(n)?uniLib.TipsUtils.showTipsDownToUp("分享标题配置有误"):t=o.newshareContent[n],s.shareImageUrl?i=s.shareImageUrl:!isNaN(n)&&h.Global.instance.shareIconUrl?("/"!=h.Global.instance.shareIconUrl[h.Global.instance.shareIconUrl.length-1]&&(h.Global.instance.shareIconUrl+="/"),i=h.Global.instance.shareIconUrl+"shareIcons/"+o.newsharepicture[n]):uniLib.TipsUtils.showTipsDownToUp("分享图片配置有误"),r="uid="+uniLib.UserInfo.uid,s.shareType&&(r+="&shareType="+s.shareType),s.roomId&&(a=JSON.parse(s.roomId))&&a.roomId&&(r+="&roomId="+a.roomId),s.wgShareData&&(r+="&wgShareData="+s.wgShareData),s.opType=Cmd.ShareOpType.share,c&&c(),this.sendShareMessage(s),[2,new Promise(function(n,e){wx.shareAppMessage({title:t,imageUrl:Array.isArray(i.match(/http/gi))&&0<i.match(/http/gi).length?i+h.Utils.getVersionControlCode():i,query:r,success:function(e){console.log(e),c&&c(),e&&(e.shareTickets&&0<e.shareTickets.length||console.log("分享的是个人")),uniLib.TipsUtils.showTipsDownToUp("分享成功"),n(e)},fail:function(e){u&&u(),uniLib.TipsUtils.showTipsDownToUp("分享失败"),n(!1)}})})]})})},e.prototype.getShareInfo=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,e){wx.getShareInfo({shareTicket:t,success:function(e){n(e)},fail:function(e){console.log("getShareInfo fail")},complete:function(){}})})]})})},e.prototype.sendShareMessage=function(o){return __awaiter(this,void 0,void 0,function(){var n,t,i;return __generator(this,function(e){switch(e.label){case 0:return[4,h.Global.instance.init().then(function(e){0<=e.errMsg.indexOf("ok")&&(n=e.code)},function(){egret.error("sendShareMessage reject")})];case 1:return e.sent(),this._data||!o?(n&&this._data&&this._data.shareType&&this._data.shareType==Cmd.ShareType.ios&&(i={},this._data.extData?(i=JSON.parse(this._data.extData)).code=n:i.code=n,this._data.extData=JSON.stringify(i)),this.sendShare(),[2]):(t=new Cmd.UploadShareInfoLittleGameLobbyCmd_CS,o.fromUid&&(t.uid=o.fromUid),o.shareType&&(t.shareType=o.shareType),o.opType&&(t.opType=o.opType),o.shareTicket&&(t.jsonShare=o.shareTicket),o.wgKvData&&(t.extData=o.wgKvData),o.wgShareData&&(t.extData=o.wgShareData),t.shareType&&t.shareType==Cmd.ShareType.ios&&n&&(i={},t.extData?(i=JSON.parse(t.extData)).code=n:i.code=n,t.extData=JSON.stringify(i)),this._data=t,this.sendShare(),[2])}})})},e.prototype.checkSession=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.checkSession({success:function(e){n(e)},fail:function(e){t(e)}})})]})})},e.prototype.sendShare=function(){NetMgr.ws&&this._data&&(NetMgr.tcpSend(this._data),this._data=null)},e}();h.ShareMessage=e}(wxgame||(wxgame={})),function(n){var e=function(){function e(){}return e.showConfirm=function(e,n,t,i,o,r){if(void 0===n&&(n=""),void 0===t&&(t="确认"),uniLib.Global.isWxGame()){var a=!1;null!=o?a=!0:o="取消",wx.showModal({title:n,content:e,showCancel:a,cancelText:o,confirmText:t,success:function(e){e.confirm&&i&&i(),e.cancel&&r&&r()},fail:function(e){console.log("showModal调用失败")}})}},e.getVersionControlCode=function(){return"?v="+(new Date).getTime()},Object.defineProperty(e,"isWxGame",{get:function(){return!!uniLib.Global.isWxGame()||(console.warn("当前测试环境不是微信小游戏，导致功能失效"),!1)},enumerable:!0,configurable:!0}),e.getPosition=function(t,i){n.Global.instance.authorize("scope.userLocation").then(function(){wx.getLocation({success:function(e){var n={code:0,data:e};t.call(i,n)},fail:function(e){uniLib.TipsUtils.showTipsDownToUp("定位失败，请重试"+e)}})},function(e){uniLib.TipsUtils.showTipsDownToUp("接口调起失败"+e)})},Object.defineProperty(e,"isIos",{get:function(){if(!uniLib.Global.isWxGame())return uniLib.Utils.isIOS();try{return!!wx.getSystemInfoSync().system.match(/IOS/gi)}catch(e){return!1}},enumerable:!0,configurable:!0}),e}();n.Utils=e}(wxgame||(wxgame={}));