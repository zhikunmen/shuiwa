var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);n.prototype=e.prototype,t.prototype=new n},packbag;!function(t){var e=function(t){function e(e){var n=t.call(this)||this;return n._info=e,n.skinName="BagBuyOrSellSkin",n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._reduceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._addBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._minBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._maxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this);var e=ConfigMgr.getInstance().getGoodCfgById(this._info.goodId);this.iconName_lbl.text=e.goodName,this.icon_img.source="game_prop_json.bag_daoju_"+this._info.goodId,e.giftGoods&&e.giftGoods[0]&&(32==e.giftGoods[0].goodId?(this.typeIcon1_img.source="bagpresent_json.bag_coin",this.typeIcon2_img.source="bagpresent_json.bag_coin"):6==e.giftGoods[0].goodId&&(this.typeIcon1_img.source="bagpresent_json.bag_diamond",this.typeIcon2_img.source="bagpresent_json.bag_diamond")),this.setNum(1)},e.prototype.onTouchHandler=function(t){if(t.target==this._closeBtn)uniLib.PopUpMgr.removePopUp(this);else if(t.target==this._confirmBtn){if(this._count=this.getNum(),this._count>this._info.number)return void uniLib.TipsUtils.showTipsDownToUp("不能大于拥有的道具数量");if(this._count<1)return void uniLib.TipsUtils.showTipsDownToUp("道具数量最少有一个");var e=new Cmd.BackpackExchangeRequestBackpackCmd_C,n=new Cmd.BackpackInfo;n.goodId=this._info.goodId,n.number=this._count,e.backpackInfo=n,NetMgr.tcpSend(e),uniLib.PopUpMgr.removePopUp(this)}else t.target==this._reduceBtn?(this._count=this.getNum(),this._count>1?(this._count--,this.setNum(this._count)):uniLib.TipsUtils.showTipsDownToUp("道具数量最少有一个")):t.target==this._addBtn?(this._count=this.getNum(),this._count<this._info.number?(this._count++,this.setNum(this._count)):uniLib.TipsUtils.showTipsDownToUp("不能大于拥有的道具数量")):t.target==this._minBtn?this.setNum(1):t.target==this._maxBtn&&this.setNum(this._info.number)},e.prototype.setNum=function(t){this._count=1,this.num_tex.text=t+"";var e=ConfigMgr.getInstance().getGoodCfgById(this._info.goodId);e.giftGoods&&e.giftGoods[0]&&(this.price_lbl.text="单价：    "+e.giftGoods[0].goodNbr,this.allPrice_lbl.text="总价：    "+e.giftGoods[0].goodNbr*t)},e.prototype.getNum=function(){var t=Number(this.num_tex.text);return null==t?-1:t},e.prototype.destroy=function(){this._closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._reduceBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._addBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._confirmBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._minBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._maxBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.removeChildren()},e}(eui.Component);t.BagBuyOrSellPanel=e,__reflect(e.prototype,"packbag.BagBuyOrSellPanel")}(packbag||(packbag={}));var packbag;!function(t){var e=function(t){function e(e){var n=t.call(this)||this;return n._info=e,n.skinName="BagPresentSkin",n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._reduceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._addBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._confirmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this);var e=ConfigMgr.getInstance().getGoodCfgById(this._info.goodId);this.daoju_name.text=e.goodName,this.daoju_name.anchorOffsetX=this.daoju_name.width>>1,this.daoju_icon.source="game_prop_json.bag_daoju_"+this._info.goodId,this._count=1,this.num_tex.text=this._count+""},e.prototype.onTouchHandler=function(t){if(t.target==this._closeBtn)uniLib.PopUpMgr.removePopUp(this);else if(t.target==this._confirmBtn){if(this._count=this.getNum(),this._count>this._info.number)return void uniLib.TipsUtils.showTipsDownToUp("不能大于拥有的道具数量");if(this._count<1)return void uniLib.TipsUtils.showTipsDownToUp("道具数量最少有一个");var e=Number(this.friend_id.text);if(0==e)return void uniLib.TipsUtils.showTipsDownToUp("请正确填写对方的ID");var n=new Cmd.BackpackPresentRequestBackpackCmd_C,o=new Cmd.BackpackInfo;o.goodId=this._info.goodId,o.number=this._count,n.backpackInfo=o,n.uid=e,NetMgr.tcpSend(n),uniLib.PopUpMgr.removePopUp(this)}else t.target==this._reduceBtn?(this._count=this.getNum(),this._count>1?(this._count--,this.num_tex.text=this._count+""):uniLib.TipsUtils.showTipsDownToUp("道具数量最少有一个")):t.target==this._addBtn&&(this._count=this.getNum(),this._count<this._info.number?(this._count++,this.num_tex.text=this._count+""):uniLib.TipsUtils.showTipsDownToUp("不能大于拥有的道具数量"))},e.prototype.getNum=function(){var t=Number(this.num_tex.text);return null==t?-1:t},e.prototype.destroy=function(){this._closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._reduceBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._addBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this._confirmBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.removeChildren()},e}(eui.Component);t.BagPresentPanel=e,__reflect(e.prototype,"packbag.BagPresentPanel")}(packbag||(packbag={}));var packbag;!function(t){var e=function(){function t(){}return t.RES_JSON="resource/packbag/packbag.res_8220b5e.json",t.THM_JSON="resource/packbag/gameEui_e667ea2.json",t.PUB_PACKBAG="pub_packbag",t.PUB_BAGPRESENT="pub_bagpresent",t.PUB_PROP="pub_prop",t}();t.PackBagConsts=e,__reflect(e.prototype,"packbag.PackBagConsts")}(packbag||(packbag={}));var packbag;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="PackBagItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;if(null==e)return this.bag_num.text="",this.bag_icon.source=null,this.touchEnabled=!1,void(this.touchChildren=!1);this.touchEnabled=!0,this.touchChildren=!0;if(void 0==e.lefttime)this.bag_num.text=e.number+"";else{var n=Math.floor(e.lefttime/86400);this.bag_num.text=n+"天"}this.bag_num.width=this.operateWidth(this.bag_num.text),this.bag_icon.source="game_prop_json.bag_daoju_"+e.goodId},e.prototype.operateWidth=function(t){for(var e=0,n=0;n<t.length;n++)e+="."==t.charAt(n)?7:"4"==t.charAt(n)?18:"天"==t.charAt(n)?26:17;return e},e}(eui.ItemRenderer);t.PackBagItem=e,__reflect(e.prototype,"packbag.PackBagItem")}(packbag||(packbag={}));var packbag;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.goodIds=[334,335,336],t.monthCards=[329,324,298],t.skinName="PackBagPanelSkin",t}return __extends(n,e),n.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this._comBtns=[this._closeBtn,this._buyBtn,this._useBtn,this._sendBtn,this._composeBtn,this._sellBtn],this._bag_lst.itemRenderer=t.PackBagItem;for(var n=0;n<this._comBtns.length;n++)this._comBtns[n].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this);this._bag_lst.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTapHandler,this),uniLib.Global.addEventListener(t.CmdConstant.BACKPACK_INFO_RETURN,this.backPackListHandler,this),uniLib.Global.addEventListener(t.CmdConstant.BACKPACK_EXCHANGE,this.backPackExchangeHandler,this),uniLib.Global.addEventListener(t.CmdConstant.BACKPACK_PRESENT,this.backPackPresentHandler,this),this.initData()},n.prototype.initData=function(){var t=new Cmd.BackpackInfoRequestBackpackCmd_C;NetMgr.tcpSend(t)},n.prototype.backPackListHandler=function(t){var e=t.param,n=e.backpackList;n&&n.length>0?(n=this.operateList(n),this._bagInfo=new eui.ArrayCollection(n),this._bag_lst.dataProvider=this._bagInfo,this._bag_lst.selectedIndex=0,this.setSelectItem(n[0])):(n=[],this._actual_total=n.length,n=this.operateList(n),this._bagInfo=new eui.ArrayCollection(n),this._bag_lst.dataProvider=this._bagInfo)},n.prototype.backPackExchangeHandler=function(t){var e=t.param,n=this.getIndexByGoodId(e.backpackInfo.goodId);n>-1&&(this._bagInfo.replaceItemAt(e.backpackInfo,n),this._info=e.backpackInfo,0==this._info.number&&this.goodZero(e.backpackInfo.goodId))},n.prototype.getIndexByGoodId=function(t){if(this._bagInfo)for(var e=0;e<this._actual_total;e++)if(this._bagInfo.source[e].goodId==t)return e;return-1},n.prototype.backPackPresentHandler=function(t){var e=t.param,n=this.getIndexByGoodId(e.backpackInfo.goodId);n>-1?(this._bagInfo.replaceItemAt(e.backpackInfo,n),this._info=e.backpackInfo,0==this._info.number&&this.goodZero(e.backpackInfo.goodId)):(this._bagInfo.replaceItemAt(e.backpackInfo,this._actual_total),this._actual_total++)},n.prototype.onItemTapHandler=function(t){this.setSelectItem(this._bag_lst.selectedItem)},n.prototype.setSelectItem=function(t){this._info=t;var e=ConfigMgr.getInstance().getGoodCfgById(t.goodId);this.select_name.text=e.goodName,this.select_icon.source="game_prop_json.bag_daoju_"+t.goodId,this.select_desc.text=e.goodIntroduction,this.goodBtnOper(e.goodBotton)},n.prototype.goodZero=function(t){if(this.goodIds.indexOf(t)>-1){var e=ConfigMgr.getInstance().getGoodCfgById(t);this.goodBtnOper(e.goodBotton)}},n.prototype.goodBtnOper=function(t){for(var e=1;e<this._comBtns.length;e++)t.indexOf(e)>-1?(this._comContain.addChild(this._comBtns[e]),0==this._info.number&&this.goodIds.indexOf(this._info.goodId)>-1?this._comBtns[e].enabled=!1:this._comBtns[e].enabled=!0):uniLib.DisplayUtils.removeFromParent(this._comBtns[e])},n.prototype.onTouchHandler=function(e){var n=this;if(e.target==this._closeBtn)uniLib.PopUpMgr.removePopUp(this);else if(e.target==this._sendBtn)LoadPanelTipMgr.getInstance().loadRes(t.PackBagConsts.PUB_BAGPRESENT,function(){uniLib.PopUpMgr.addPopUp(t.BagPresentPanel,null,!0,!0,0,uniLib.PopUpEffect.CENTER,0,0,n._info)});else if(e.target==this._useBtn){if(336==this._info.goodId)return LobbyModuleMgr.getInstance().showLobbyActivePanel(1),void uniLib.PopUpMgr.removePopUp(this);var o=new Cmd.BackpackExchangeRequestBackpackCmd_C,i=new Cmd.BackpackInfo;i.goodId=this._info.goodId,i.number=1,o.backpackInfo=i,NetMgr.tcpSend(o)}else if(e.target==this._buyBtn)if(329==this._info.goodId||298==this._info.goodId){var o=new Cmd.GetMonthCardInfoLobbyCmd_C;o.lobbyId=NetMgr.getLoginCfg().lobbyId,NetMgr.tcpSend(o)}else this._info.goodId>=348&&this._info.goodId<=355&&LobbyModuleMgr.getInstance().showMarketPanel(2);else if(e.target==this._composeBtn){var o=new Cmd.BackpackExchangeRequestBackpackCmd_C,i=new Cmd.BackpackInfo;i.goodId=this._info.goodId,i.number=1,o.backpackInfo=i,NetMgr.tcpSend(o)}else e.target==this._sellBtn&&LoadPanelTipMgr.getInstance().loadRes(t.PackBagConsts.PUB_BAGPRESENT,function(){uniLib.PopUpMgr.addPopUp(t.BagBuyOrSellPanel,null,!0,!0,0,uniLib.PopUpEffect.CENTER,0,0,n._info)})},n.prototype.operateList=function(t){var e=[];if(uniLib.Global.isWxGame()&&0!=uniLib.Global.is_sandbox)for(var n=0;n<t.length;n++)-1==this.monthCards.indexOf(t[n].goodId)&&e.push(t[n]);else e=t;this._actual_total=e.length;var o=12-e.length;if(o>0)for(var i=0;o>i;i++)e.push(null);else if(0>o)for(var s=e.length%12,i=0;s>i;i++)e.push(null);return e},n.prototype.destroy=function(){for(var e=0;e<this._comBtns.length;e++)this._comBtns[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this);this._comBtns=null,this._bag_lst.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTapHandler,this),uniLib.Global.removeEventListener(t.CmdConstant.BACKPACK_INFO_RETURN,this.backPackListHandler,this),uniLib.Global.removeEventListener(t.CmdConstant.BACKPACK_EXCHANGE,this.backPackExchangeHandler,this),uniLib.Global.removeEventListener(t.CmdConstant.BACKPACK_PRESENT,this.backPackPresentHandler,this),this.removeChildren()},n}(eui.Component);t.PackBagPanel=e,__reflect(e.prototype,"packbag.PackBagPanel")}(packbag||(packbag={}));var packbag;!function(t){var e=function(){function t(){}return t.BACKPACK_INFO_RETURN="backpack_info_return",t.BACKPACK_EXCHANGE="backpack_exchange",t.BACKPACK_PRESENT="backpack_present",t}();t.CmdConstant=e,__reflect(e.prototype,"packbag.CmdConstant")}(packbag||(packbag={}));var PackBagReciveMgr=function(){function t(){}return t}();__reflect(PackBagReciveMgr.prototype,"PackBagReciveMgr");var Cmd;!function(t){function e(t){t.resultCode?t.desc&&uniLib.TipsUtils.showTipsDownToUp(t.desc):uniLib.Global.dispatchEvent(packbag.CmdConstant.BACKPACK_INFO_RETURN,t)}function n(t){if(0==t.resultCode||10001==t.resultCode){if(10001==t.resultCode){var e=new uniLib.MsgBox("恭喜您成功合成现金红包，请前往”兑换“界面提现","","确定",function(){LobbyModuleMgr.getInstance().showLobbyActivePanel(1)},"取消",null,this);uniLib.PopUpMgr.addPopUp(e,null,!0,!0,!1,uniLib.PopUpEffect.CENTER)}uniLib.Global.dispatchEvent(packbag.CmdConstant.BACKPACK_EXCHANGE,t)}else t.desc&&uniLib.TipsUtils.showTipsDownToUp(t.desc)}function o(t){void 0==t.resultCode?uniLib.Global.dispatchEvent(packbag.CmdConstant.BACKPACK_PRESENT,t):0==t.resultCode?(uniLib.Global.dispatchEvent(packbag.CmdConstant.BACKPACK_PRESENT,t),uniLib.TipsUtils.showTipsDownToUp("赠送成功！")):t.desc&&uniLib.TipsUtils.showTipsDownToUp(t.desc)}t.OnBackpackInfoReturnBackpackCmd_S=e,t.OnBackpackExchangeReturnBackpackCmd_S=n,t.OnBackpackPresentReturnBackpackCmd_S=o}(Cmd||(Cmd={}));