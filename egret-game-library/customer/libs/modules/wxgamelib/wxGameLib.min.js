/*!
 * wxGameLib - compressed JS
 * @licence wxGameLib - v0.1.0 (2018-10-10)
 *  qq:93749937 | Licence: helojo
 */

!function(e){var n=function(){function e(){}return e.DEVELOP="develop",e.TRIAL="trial",e.RELEASE="release",e}();e.envVersionConst=n;var t=function(){function e(){}return e.DEFAULTTITLE='回复"关注"获取关注链接',e}();e.CustomerServiceConst=t}(wxgame||(wxgame={}));var __awaiter=this&&this.__awaiter||function(r,a,s,c){return new(s||(s=Promise))(function(e,n){function t(e){try{i(c.next(e))}catch(e){n(e)}}function o(e){try{i(c.throw(e))}catch(e){n(e)}}function i(n){n.done?e(n.value):new s(function(e){e(n.value)}).then(t,o)}i((c=c.apply(r,a||[])).next())})},__generator=this&&this.__generator||function(t,o){var i,r,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=o.call(t,s)}catch(e){n=[6,e],r=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}};!function(s){var e=function(){function e(){this.isFirst=!0}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return s.Utils.isWxGame?(this.isFirst&&(s.Message.instance.init(),s.ShareMessage.instance.showShareMenu(!0),this.isFirst=!1),[2,new Promise(function(n,t){wx.login({success:function(e){n(e),console.log("login success: "+e.code)},fail:function(e){t(!1),console.error("login fail: "+e)},complete:function(){}})})]):[2]})})},e.prototype.exitMiniProgram=function(t,o,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return s.Utils.isWxGame?[2,new Promise(function(e,n){wx.exitMiniProgram({success:function(){t&&t(),e(!0)},fail:function(){o&&o(),n(!1)},complete:i})})]:[2]})})},e.prototype.openCustomerServiceConversation=function(e,o,i){return void 0===o&&(o=s.CustomerServiceConst.DEFAULTTITLE),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return s.Utils.isWxGame?[2,new Promise(function(n,t){wx.openCustomerServiceConversation({sessionFrom:"",showMessageCard:!0,sendMessageTitle:o,sendMessagePath:"",sendMessageImg:i?0<i.match(/http/gi).length?i+s.Utils.getVersionControlCode():i:"",success:function(e){n(e)},fail:function(e){t(e)}})})]:[2]})})},e.prototype.navigateToMiniProgram=function(o,i,r,a){return void 0===i&&(i=""),void 0===r&&(r={}),void 0===a&&(a=s.envVersionConst.RELEASE),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.navigateToMiniProgram({appId:o,path:i,extraData:r,envVersion:a,success:function(e){n(e)},fail:function(e){console.error("navigateToMiniProgram fail"),t(e)}})})]})})},e.prototype.openSetting=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.openSetting({success:function(e){n(e)},fail:function(e){t(e),console.log("打开设置失败")}})})]})})},e}();s.Global=e}(wxgame||(wxgame={})),function(o){var e=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.launchOption=wx.getLaunchOptionsSync(),this.initLaunchOption(),this.addOnShowEvent()},e.prototype.initLaunchOption=function(){if(this.launchOption){var e,n=this.launchOption;n.query&&(e=n.query);var t=new uniLib.WXShareVo;t.opType=Cmd.ShareOpType.click,e.shareType&&(t.shareType=Number(e.shareType)),e.wgShareData&&(t.wgShareData=e.wgShareData),e&&e.uid&&(t.fromUid=Number(e.uid),n.shareTicket?o.ShareMessage.instance.getShareInfo(n.shareTicket).then(function(e){e&&0<=e.errMsg.indexOf("ok")&&(t.shareTicket=JSON.stringify(e),o.ShareMessage.instance.sendShareMessage(t))}).catch(function(e){console.log("获取群消息失败",e),uniLib.TipsUtils.showTipsDownToUp("获取群消息失败")}):o.ShareMessage.instance.sendShareMessage(t)),this.launchOption=null}},e.prototype.addOnShowEvent=function(){var n=this;wx.offShow(function(e){n.onShow(e)}),wx.onShow(function(e){n.onShow(e)})},e.prototype.onShow=function(e){!this.launchOption&&e&&(this.launchOption=e),this.initLaunchOption()},e.prototype.setUserCloudStorage=function(e){return new Promise(function(n,t){wx.setUserCloudStorage({KVDataList:e,success:function(e){console.log("setUserCloudStorage success",e),n(e)},fail:function(e){console.error("setUserCloudStorage success",e),t(e)}})})},e}();o.Message=e}(wxgame||(wxgame={})),function(n){var e=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.sendShareData=function(e){n.Utils.isWxGame&&(this._openDataContext=wx.getOpenDataContext(),this._openDataContext.postMessage(e))},e.prototype.createDisplayObject=function(e,n,t,o){var i=window.sharedCanvas;i.width=n,i.height=t;var r=new egret.BitmapData(i);r.$deleteSource=!1;var a=new egret.Texture;a._setBitmapData(r);var s=new egret.Bitmap(a);(s.width=n,s.height=t,s.y=o,"webgl"==egret.Capabilities.renderMode)&&(egret.wxgame.WebGLRenderContext.getInstance().context.wxBindCanvasTexture||egret.startTick(function(e){return egret.WebGLUtils.deleteWebGLTexture(r.webGLTexture),r.webGLTexture=null,!1},this));return s},e}();n.OpenData=e}(wxgame||(wxgame={}));var wxgame;__awaiter=this&&this.__awaiter||function(r,a,s,c){return new(s||(s=Promise))(function(e,n){function t(e){try{i(c.next(e))}catch(e){n(e)}}function o(e){try{i(c.throw(e))}catch(e){n(e)}}function i(n){n.done?e(n.value):new s(function(e){e(n.value)}).then(t,o)}i((c=c.apply(r,a||[])).next())})},__generator=this&&this.__generator||function(t,o){var i,r,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=o.call(t,s)}catch(e){n=[6,e],r=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}};!function(h){var e=function(){function e(){}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.onShareAppMessage=function(o,i,r){void 0===o&&(o=""),void 0===i&&(i=""),void 0===r&&(r=""),wx.onShareAppMessage(function(e){if(!o||""==o.trim()){var n=void 0,t=h.Global.instance.tableLobbyGameList;t&&Array.isArray(t.newshareContent)&&(n=Math.floor(Math.random()*t.newshareContent.length),o=t.newshareContent[n],"/"!=h.Global.instance.shareIconUrl[h.Global.instance.shareIconUrl.length-1]&&(h.Global.instance.shareIconUrl+="/"),i=h.Global.instance.shareIconUrl+"shareIcons/"+t.newsharepicture[n])}return console.log("用户点击事件"),{title:o,imageUrl:i,query:r}})},e.prototype.showShareMenu=function(o){return void 0===o&&(o=!0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.showShareMenu({withShareTicket:o,success:function(e){console.log("showShareMenu success:  "+e),n(!0)},fail:function(e){console.log("showShareMenu fail:  "+e),t(!1)},complete:function(){}})})]})})},e.prototype.hideShareMenu=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.hideShareMenu({success:function(e){console.log("hideShareMenu success:  "+e),n(!0)},fail:function(e){console.log("hideShareMenu fail:  "+e),t(!1)},complete:function(){}})})]})})},e.prototype.updateShareMenu=function(o){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.updateShareMenu({withShareTicket:o,success:function(e){console.log("updateShareMenu success:  "+e),n(!0)},fail:function(e){console.log("updateShareMenu fail:  "+e),t(!1)},complete:function(){}})})]})})},e.prototype.shareAppMessage=function(s,c,u){return __awaiter(this,void 0,void 0,function(){var t,o,n,i,r,a;return __generator(this,function(e){return o=t="",(i=h.Global.instance.tableLobbyGameList)&&Array.isArray(i.newshareContent)&&(n=Math.floor(Math.random()*i.newshareContent.length)),s.title?t=s.title:isNaN(n)?uniLib.TipsUtils.showTipsDownToUp("分享标题配置有误"):t=i.newshareContent[n],s.shareImageUrl?o=s.shareImageUrl:!isNaN(n)&&h.Global.instance.shareIconUrl?("/"!=h.Global.instance.shareIconUrl[h.Global.instance.shareIconUrl.length-1]&&(h.Global.instance.shareIconUrl+="/"),o=h.Global.instance.shareIconUrl+"shareIcons/"+i.newsharepicture[n]):uniLib.TipsUtils.showTipsDownToUp("分享图片配置有误"),r="uid="+uniLib.UserInfo.uid,s.shareType&&(r+="&shareType="+s.shareType),s.roomId&&(a=JSON.parse(s.roomId))&&a.roomId&&(r+="&roomId="+a.roomId),s.wgShareData&&(r+="&wgShareData="+s.wgShareData),s.opType=Cmd.ShareOpType.share,this.sendShareMessage(s),[2,new Promise(function(n,e){wx.shareAppMessage({title:t,imageUrl:Array.isArray(o.match(/http/gi))&&0<o.match(/http/gi).length?o+h.Utils.getVersionControlCode():o,query:r,success:function(e){console.log(e),c&&c(),e&&(e.shareTickets&&0<e.shareTickets.length||console.log("分享的是个人")),uniLib.TipsUtils.showTipsDownToUp("分享成功"),n(e)},fail:function(e){u&&u(),uniLib.TipsUtils.showTipsDownToUp("分享失败"),n(!1)}})})]})})},e.prototype.getShareInfo=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,e){wx.getShareInfo({shareTicket:t,success:function(e){n(e)},fail:function(e){console.log("getShareInfo fail")},complete:function(){}})})]})})},e.prototype.sendShareMessage=function(i){return __awaiter(this,void 0,void 0,function(){var n,t,o;return __generator(this,function(e){switch(e.label){case 0:return[4,h.Global.instance.init().then(function(e){0<=e.errMsg.indexOf("ok")&&(n=e.code)},function(){egret.error("sendShareMessage reject")})];case 1:return e.sent(),this._data||!i?(n&&this._data&&this._data.shareType&&this._data.shareType==Cmd.ShareType.ios&&(o={},this._data.extData?(o=JSON.parse(this._data.extData)).code=n:o.code=n,this._data.extData=JSON.stringify(o)),this.sendShare(),[2]):(t=new Cmd.UploadShareInfoLittleGameLobbyCmd_CS,i.fromUid&&(t.uid=i.fromUid),i.shareType&&(t.shareType=i.shareType),i.opType&&(t.opType=i.opType),i.shareTicket&&(t.jsonShare=i.shareTicket),i.wgKvData&&(t.extData=i.wgKvData),i.wgShareData&&(t.extData=i.wgShareData),t.shareType&&t.shareType==Cmd.ShareType.ios&&n&&(o={},t.extData?(o=JSON.parse(t.extData)).code=n:o.code=n,t.extData=JSON.stringify(o)),this._data=t,this.sendShare(),[2])}})})},e.prototype.checkSession=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(n,t){wx.checkSession({success:function(e){n(e)},fail:function(e){t(e)}})})]})})},e.prototype.sendShare=function(){NetMgr.ws&&this._data&&(NetMgr.tcpSend(this._data),this._data=null)},e}();h.ShareMessage=e}(wxgame||(wxgame={})),function(e){var n=function(){function e(){}return e.showConfirm=function(e,n,t,o,i,r){void 0===n&&(n=""),void 0===t&&(t="确认");var a=!1;null!=i?a=!0:i="取消",wx.showModal({title:n,content:e,showCancel:a,cancelText:i,confirmText:t,success:function(e){e.confirm&&o&&o(),e.cancel&&r&&r()},fail:function(e){console.log("showModal调用失败")}})},e.getVersionControlCode=function(){return"?v="+(new Date).getTime()},Object.defineProperty(e,"isWxGame",{get:function(){return!!uniLib.Global.isWxGame()||(console.warn("当前测试环境不是微信小游戏，导致功能失效"),!1)},enumerable:!0,configurable:!0}),e}();e.Utils=n}(wxgame||(wxgame={}));